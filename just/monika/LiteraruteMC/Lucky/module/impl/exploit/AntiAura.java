package just.monika.LiteraruteMC.Lucky.module.impl.exploit;

import just.monika.LiteraruteMC.Lucky.event.EventListener;
import just.monika.LiteraruteMC.Lucky.event.impl.network.PacketSendEvent;
import just.monika.LiteraruteMC.Lucky.event.impl.player.MotionEvent;
import just.monika.LiteraruteMC.Lucky.module.Category;
import just.monika.LiteraruteMC.Lucky.module.Module;
import just.monika.LiteraruteMC.Lucky.module.impl.combat.KillAura;
import just.monika.LiteraruteMC.Lucky.settings.impl.ModeSetting;
import just.monika.LiteraruteMC.Lucky.utils.network.PacketUtils;
import just.monika.LiteraruteMC.Lucky.utils.time.TimerUtil;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.C03PacketPlayer;

import java.util.List;
import java.util.concurrent.CopyOnWriteArrayList;

public final class AntiAura extends Module {

    private final ModeSetting mode = new ModeSetting("Mode", "Legit", "Legit", "Rage");

    private final List<Packet<?>> packetsList = new CopyOnWriteArrayList<>();

    private final TimerUtil timer = new TimerUtil();
    private double x,y,z;
    private final EventListener<MotionEvent> motionEventEventListener = e -> {
        switch (mode.getMode()){
            case "Legit":
                if(timer.hasTimeElapsed(50)){
                    if(!packetsList.isEmpty()) {
                        for (Packet<?> packet : packetsList) {
                            PacketUtils.sendPacketNoEvent(packet);
                            packetsList.remove(packet);
                        }
                    }
                    timer.reset();
                }
                break;
            case "Rage":
                x = mc.thePlayer.posX;
                y = mc.thePlayer.posY;
                z = mc.thePlayer.posZ;
                double yaw = Math.toRadians(mc.thePlayer.rotationYaw);
                double xValue = -Math.sin(yaw) * 2;
                double zValue = Math.cos(yaw) * 2;
                if(KillAura.attacking){
                    mc.thePlayer.setPosition(x + xValue,y,z + zValue);
                    if(mc.thePlayer.ticksExisted % 2 == 0) {
                        mc.thePlayer.setPosition(x - xValue, y, z - zValue);
                    }
                }
                break;
        }
    };

    private final EventListener<PacketSendEvent> packetSendEventEventListener = e -> {
        if(e.getPacket() instanceof C03PacketPlayer){
            packetsList.add(e.getPacket());
            e.cancel();
        }
    };

    public AntiAura() {
        super("AntiAura", Category.EXPLOIT, "can sometimes cause your enemies aura to stop working properly");
        this.addSettings(mode);
    }
}
